---
---
<!DOCTYPE html>
<html>
	<head>
		<title>Gramafier</title>
	</head>
	<body>
		<textarea id="input" wrap="off" style="position: fixed; left: 0; width: 50%; top: 0; bottom: 0;">{% include_relative grammars/rockstar.peg %}</textarea>
		<textarea id="output" wrap="off" style="position: fixed; right: 0; width: 50%; top: 0; bottom: 0; overflow: scroll;">OUT
		</textarea>
	<script>
		function transform(s) {
			s = s.replace(/ +[A-Za-z]+:/g, ' ');
			s = s.replace(/(@|\/\/)[^\n]+\n/g, '');
			s = s.replace(/ -memoize/g, '');
			s = s.replace(/\/\*[\s\S]*?\*\//gmi, '');
			s = s.replace(/#[A-Za-z0-9]+{/g, '{');

			s = s.replace(/{[^}]*{[^}]*{[^}]*}.*}.*}\n*/g, '');
			s = s.replace(/{[^}]*{[^}]*.*}.*}\n/g, '');
			s = s.replace(/{[^}]*}\n*/g, '');

			s = s.replace(/ <[^>]+<[^>]+<[^>]+>>>/g, '')
			s = s.replace(/ <[^>]+<[^>]+>>/g, '');
			s = s.replace(/\s<[^>]+>/g, '');

			s = s.replace(/[ \t\n\r]*=[ \t\n\r]/g, ' { ');
			s = s.replace(/([A-Za-z0-9_]+ +\{)/g, '}\n\n$1');
			s = s.replace(/\s\/\s/g, ' | ');
			s = s.replace(/'\/'/g, '"/"');
			s = s.replace(/'/g, '"');
			s = s.replace(/[ \t\r\n]+/g, ' ');
			s = s.replace(/\{/g, '{\n    ');
			s = s.replace(/\|/g, '\n  | ');
			s = s.replace(/\} */g, '\n}\n\n');
			s = s.replace(/\//g, '|');
			s = s.replace(/'|'/g, '"/"');
			s = s.replace(/^[\s\}]*program \{/mig, `@external propSource highlighting from "./highlight.js"

@top Program {`);
			document.getElementById('output').innerHTML = s;
		}
		document.getElementById('input').addEventListener("keyup",
			function() { transform(this.value) }
		);

		transform(document.getElementById('input').value);
	</script>
	</body>

</html>

